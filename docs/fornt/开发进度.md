# 在线课程平台前端开发进度

## 已完成工作

### 项目初始化与配置
- [x] 项目基础架构创建（React + TypeScript + Vite）
- [x] 安装和配置核心依赖
  - React Router DOM
  - Zustand
  - Axios
  - React Hook Form + Zod
  - Shadcn UI组件库
  - Tailwind CSS
  - 其他工具库
- [x] 路径别名配置（@/ -> src/）
- [x] ESLint和TypeScript配置
- [x] Vite代理配置（解决跨域问题）

### 目录结构设计
- [x] 创建核心目录结构
  - assets：静态资源
  - components：通用组件
  - hooks：自定义钩子
  - lib：工具函数库
  - pages：页面组件
  - services：API服务
  - stores：状态管理
  - types：类型定义

### API服务与数据类型
- [x] 定义API接口返回数据类型（ApiResponse, PageResponse等）
- [x] 定义用户、角色、权限等模型类型
- [x] 实现基于Axios的API请求工具
  - 请求拦截器（添加token）
  - 响应拦截器（处理错误、刷新token）
  - 封装GET、POST、PUT、DELETE方法
- [x] 实现认证服务（登录、注册、获取验证码等）
- [x] 优化认证请求处理，修复认证相关错误
- [x] 实现邮箱验证码请求服务
  - 定义`EmailVerificationRequest`接口
  - 添加`sendEmailVerificationCode`方法

### 状态管理
- [x] 实现认证状态管理（authStore）
  - 用户登录状态
  - Token管理
  - 登录/注册/注销功能
  - 添加邮箱验证码发送功能
- [x] 实现UI状态管理（uiStore）
  - 侧边栏状态
  - 主题管理（亮色/暗色/系统）

### 路由管理
- [x] 定义应用路由结构
- [x] 实现路由守卫（RequireAuth）
- [x] 实现懒加载

### 页面开发
- [x] 布局组件
  - MainLayout：主布局（包含导航栏和侧边栏）
  - AuthLayout：认证页面布局
- [x] 认证页面
  - 登录页面（包含表单验证和验证码）
  - 注册页面（优化为两步流程：基本信息 + 邮箱验证）
- [x] 基础页面
  - 首页
  - 404页面
- [x] 用户页面（占位实现）
  - 个人资料页
  - 设置页面
- [x] 管理页面（占位实现）
  - 用户管理
  - 角色管理
  - 权限管理

### UI组件
- [x] 实现导航栏组件（Navbar）
- [x] 实现侧边栏组件（Sidebar）
- [x] 实现主题切换组件（ThemeSwitcher）
- [x] 实现验证码组件（Captcha）
- [x] 默认使用亮色主题

### 注册流程优化
- [x] 重构注册页面为分步表单
  - 第一步：填写基本信息（用户名、密码）
  - 第二步：邮箱验证（邮箱、验证码、邮箱验证码）
- [x] 增强用户体验
  - 步骤间数据保存与传递
  - 步骤间状态保持
  - 增加返回上一步功能
  - 邮箱验证码发送倒计时
- [x] 修复API路径问题
  - 更新验证码获取接口路径
  - 调整为两步请求：先获取key再获取图片

## 进行中工作

### 用户管理功能
- [ ] 创建用户服务(userService.ts)
  - GET `/api/users` - 获取用户列表
  - GET `/api/users/{id}` - 获取用户详情
  - POST `/api/users` - 创建用户
  - PUT `/api/users/{id}` - 更新用户
  - DELETE `/api/users/{id}` - 删除用户
- [ ] 实现用户管理状态(userManagementStore.ts)
- [ ] 完善用户列表页面
  - 添加数据表格组件
  - 实现分页功能
  - 实现搜索筛选
- [ ] 实现用户表单组件
  - 创建用户表单
  - 编辑用户表单
  - 表单验证

### 角色与权限管理
- [ ] 创建角色服务(roleService.ts)
  - GET `/api/roles` - 获取角色列表
  - GET `/api/roles/{id}` - 获取角色详情
  - POST `/api/roles` - 创建角色
  - PUT `/api/roles/{id}` - 更新角色
  - DELETE `/api/roles/{id}` - 删除角色
  - PUT `/api/roles/{id}/permissions` - 分配权限
- [ ] 创建权限服务(permissionService.ts)
  - GET `/api/permissions` - 获取权限列表
  - GET `/api/permissions/{id}` - 获取权限详情
- [ ] 实现角色管理页面
- [ ] 实现权限管理页面

### 个人中心功能
- [ ] 获取当前用户信息
- [ ] 实现个人资料页面
- [ ] 实现设置页面

## 待开发工作
- [ ] 课程模块页面
  - 课程列表
  - 课程详情
  - 课程搜索
- [ ] 学习模块页面
  - 视频播放
  - 课程笔记
  - 进度记录
- [ ] 订单与支付模块
  - 课程购买
  - 订单管理
- [ ] 管理模块完善
  - 用户管理CRUD
  - 角色管理CRUD
  - 权限管理CRUD
  - 课程管理
  - 内容审核

## 问题与解决方案
- [x] 路由加载问题：创建了页面占位组件解决路由导入错误
- [x] 暗色背景问题：添加了主题切换器并默认使用亮色主题
- [x] 跨域问题：通过配置Vite代理解决
- [x] 验证码获取问题：修复验证码请求URL和处理方式，确保正确显示验证码图片
- [x] 验证码处理流程：优化验证码组件，确保正确使用后端生成的验证码Key
- [x] 登录会话问题：修复响应拦截器对认证请求的处理，避免误报"会话过期"
- [x] 错误处理问题：增强错误处理和日志记录，提供更明确的错误提示
- [x] 验证码路径问题：修复了验证码获取路径，改为先获取key再获取图片
- [x] 邮件发送配置问题：修复后端邮件发送配置，确保发件人地址与SMTP认证用户一致
- [ ] 移动端适配：需要优化布局和响应式设计

## 注册流程与邮箱验证

### 优化后的注册流程
- **第一步：基本信息填写**
  - 用户名输入（验证长度4-20个字符）
  - 密码输入（验证长度6-20个字符）
  - 确认密码（验证与密码一致）
  - 数据暂存在组件state中
  - 点击"下一步"进入第二步

- **第二步：邮箱验证**
  - 显示已填写的用户名提示
  - 邮箱地址输入
  - 图形验证码输入与获取
  - 发送邮箱验证码按钮（带60秒倒计时）
  - 邮箱验证码输入
  - 点击"完成注册"提交所有数据
  - "返回上一步"按钮支持修改基本信息

### 邮箱验证码处理
- 验证码发送前进行即时表单验证
- 验证码发送成功后启用倒计时，防止频繁请求
- 验证码发送成功后才允许点击"完成注册"按钮
- 使用toast提示验证码发送状态和错误信息

### 前端技术实现
- 使用zod进行强类型表单验证
- 使用React Hook Form管理表单状态和提交
- 使用shadcn/ui的Tabs组件实现分步UI
- 使用useState保存跨步骤数据
- 使用useEffect管理验证码倒计时

## 下一步具体计划（1-2周）

### 第1周：用户管理功能
1. 创建用户服务模块
   - 实现用户列表获取
   - 实现用户详情获取
   - 实现用户创建/编辑/删除
2. 实现用户管理状态库
   - 定义状态结构
   - 实现用户数据获取与更新
3. 完善用户列表页面
   - 实现数据表格
   - 实现分页和筛选
   - 添加创建/编辑/删除操作

### 第2周：角色权限管理
1. 创建角色和权限服务模块
   - 实现角色列表获取
   - 实现权限列表获取
   - 实现角色创建/编辑/删除
   - 实现角色权限分配
2. 实现角色和权限管理状态库
   - 定义状态结构
   - 实现数据获取与更新
3. 完善角色和权限管理页面
   - 实现数据表格
   - 实现角色创建/编辑表单
   - 实现权限分配界面

### 并行任务：个人中心功能
1. 获取当前用户信息
   - 在登录成功后获取用户详情
   - 在authStore中保存用户信息
2. 完善个人资料页面
   - 显示用户基本信息
   - 实现个人信息编辑功能
3. 实现设置页面
   - 界面偏好设置
   - 密码修改功能
