# 项目结构说明

本项目采用分层架构，遵循最佳实践进行组织：

```
src/main/java/com/zhangziqi/online_course_mine
├── config                 # 配置类
│   ├── security          # 安全相关配置
│   ├── redis            # Redis相关配置
├── constant               # 常量定义
├── controller             # 控制器层
├── exception              # 自定义异常
├── model                  # 数据模型
│   ├── entity           # 实体类
│   ├── dto              # 数据传输对象
│   ├── vo               # 视图对象
│   ├── enums            # 枚举类型
├── repository             # 数据访问层
├── security               # 安全相关组件
│   ├── jwt              # JWT相关
├── service                # 服务层
│   ├── impl             # 服务实现
├── util                   # 工具类
```

## 分层职责

1. **Controller层**：负责处理HTTP请求，参数验证，返回响应
   - 仅负责接收请求和返回响应，不包含业务逻辑
   - 参数验证和基本的请求合法性检查
   - 调用Service层处理业务，不直接操作Repository
   - 统一的响应格式封装
   - 不应该直接依赖基础设施服务（如MinIO、Redis等）

2. **Service层**：实现业务逻辑
   - 封装所有业务规则和流程
   - 事务管理
   - 数据校验和业务规则验证
   - 可以调用其他Service和Repository
   - 负责与基础设施服务交互（如文件存储、缓存、邮件等）
   - 异常处理和业务错误转换

3. **Repository层**：数据访问操作
   - 提供数据访问接口
   - 不包含业务逻辑
   - 专注于数据CRUD操作

4. **Model层**：数据结构定义
   - Entity: JPA实体类
   - DTO: 数据传输对象，用于服务层之间的数据传递
   - VO: 视图对象，用于前端展示

5. **Config层**：应用配置

6. **Security层**：安全相关组件

7. **Util层**：通用工具类

## 架构设计原则

1. **关注点分离**：每一层只关注自己的职责
2. **依赖方向**：上层依赖下层，下层不依赖上层
3. **接口隔离**：通过接口定义服务边界
4. **单一职责**：每个类只负责一项功能
5. **最小知识原则**：一个对象应当对其他对象有最少的了解

## 示例：用户头像上传

**不推荐的方式**（在Controller中处理业务逻辑）：
```java
@PostMapping("/avatar")
public Result<Map<String, String>> uploadAvatar(MultipartFile file) {
    // 验证文件类型和大小（业务逻辑）
    // 生成文件名（业务逻辑）
    // 直接调用MinioService上传文件（直接依赖基础设施）
    // 调用UserService更新用户头像
    // 返回URL
}
```

**推荐的方式**（职责分离）：
```java
@PostMapping("/avatar")
public Result<Map<String, String>> uploadAvatar(MultipartFile file) {
    // 从安全上下文获取用户名
    String username = getCurrentUsername();
    // 调用Service处理所有业务逻辑
    Map<String, String> result = userService.uploadAndUpdateAvatar(username, file);
    // 返回结果
    return Result.success(result);
}
```

Service层封装所有业务逻辑：
```java
@Service
public class UserServiceImpl implements UserService {
    // 注入所需依赖
    private final MinioService minioService;
    
    @Override
    public Map<String, String> uploadAndUpdateAvatar(String username, MultipartFile file) {
        // 验证文件类型和大小
        // 生成文件名
        // 上传文件
        // 删除旧头像
        // 更新用户头像
        // 返回结果
    }
}
```

通过这种方式，实现了关注点分离，提高了代码的可维护性和可测试性。

## 命名规范

- **Controller**: 以Controller结尾（如UserController）
- **Service**: 接口以Service结尾，实现类以ServiceImpl结尾
- **Repository**: 以Repository结尾
- **Entity**: 实体类名与表名对应
- **DTO**: 以DTO结尾
- **VO**: 以VO结尾

## 代码规范

- 使用Lombok简化代码
- 使用统一的返回格式
- 异常统一处理
- 注释完善
- 单元测试覆盖关键逻辑 